version: '3.8'
services:
  backend:
    build: ./backend
    # Host port can be overridden with the BACKEND_PORT env var (default 8080)
    ports:
      - "${BACKEND_PORT:-8080}:8080"
    environment:
      - RUST_LOG=debug
  # Pass the frontend host port into the container so the server
  # can construct the correct allowed CORS origin for the demo frontend.
  # Do NOT pass BACKEND_PORT here â€“ the server should bind to the
  # container-internal port 8080 and docker will map the host port.
      - FRONTEND_PORT=${FRONTEND_PORT:-3000}

  frontend:
    build: ./frontend
    # Host port can be overridden with the FRONTEND_PORT env var (default 3000)
    ports:
      - "${FRONTEND_PORT:-3000}:80"
    depends_on:
      - backend